; -------------------------------------------------------------------------
; ~Start~ Slots Config.
Slot1:
	GuiControl, % ( SelectedSlots[1, 1] := !SelectedSlots[1, 1] ) ? "Show" : "Hide", Selected1 ; 0 = Off, 1 = On
Return

Slot2:
	GuiControl, % ( SelectedSlots[2, 1] := !SelectedSlots[2, 1] ) ? "Show" : "Hide", Selected2
Return

Slot3:
	GuiControl, % ( SelectedSlots[3, 1] := !SelectedSlots[3, 1] ) ? "Show" : "Hide", Selected3
Return

Slot4:
	GuiControl, % ( SelectedSlots[4, 1] := !SelectedSlots[4, 1] ) ? "Show" : "Hide", Selected4
Return

Slot5:	
	GuiControl, % ( SelectedSlots[5, 1] := !SelectedSlots[5, 1] ) ? "Show" : "Hide", Selected5
Return

Slot6:
	GuiControl, % ( SelectedSlots[6, 1] := !SelectedSlots[6, 1] ) ? "Show" : "Hide", Selected6
Return

Slot7:
	GuiControl, % ( SelectedSlots[7, 1] := !SelectedSlots[7, 1] ) ? "Show" : "Hide", Selected7
Return

Slot8:
	GuiControl, % ( SelectedSlots[8, 1] := !SelectedSlots[8, 1] ) ? "Show" : "Hide", Selected8
Return

Slot9:
	GuiControl, % ( SelectedSlots[9, 1] := !SelectedSlots[9, 1] ) ? "Show" : "Hide", Selected9
Return

Slot10:
	GuiControl, % ( SelectedSlots[10, 1] := !SelectedSlots[10, 1] ) ? "Show" : "Hide", Selected10
Return

Slot11:
	GuiControl, % ( SelectedSlots[11, 1] := !SelectedSlots[11, 1] ) ? "Show" : "Hide", Selected11
Return

Slot12:
	GuiControl, % ( SelectedSlots[12, 1] := !SelectedSlots[12, 1] ) ? "Show" : "Hide", Selected12
Return

Slot13:
	GuiControl, % ( SelectedSlots[13, 1] := !SelectedSlots[13, 1] ) ? "Show" : "Hide", Selected13
Return

Slot14:
	GuiControl, % ( SelectedSlots[14, 1] := !SelectedSlots[14, 1] ) ? "Show" : "Hide", Selected14
Return

Slot15:
	GuiControl, % ( SelectedSlots[15, 1] := !SelectedSlots[15, 1] ) ? "Show" : "Hide", Selected15
Return

Slot16:
	GuiControl, % ( SelectedSlots[16, 1] := !SelectedSlots[16, 1] ) ? "Show" : "Hide", Selected16
Return

Slot17:
	GuiControl, % ( SelectedSlots[17, 1] := !SelectedSlots[17, 1] ) ? "Show" : "Hide", Selected17
Return

Slot18:
	GuiControl, % ( SelectedSlots[18, 1] := !SelectedSlots[18, 1] ) ? "Show" : "Hide", Selected18
Return

Slot19:
	GuiControl, % ( SelectedSlots[19, 1] := !SelectedSlots[19, 1] ) ? "Show" : "Hide", Selected19
Return

Slot20:
	GuiControl, % ( SelectedSlots[20, 1] := !SelectedSlots[20, 1] ) ? "Show" : "Hide", Selected20
Return

Slot21:
	GuiControl, % ( SelectedSlots[21, 1] := !SelectedSlots[21, 1] ) ? "Show" : "Hide", Selected21
Return

Slot22:
	GuiControl, % ( SelectedSlots[22, 1] := !SelectedSlots[22, 1] ) ? "Show" : "Hide", Selected22
Return

Slot23:
	GuiControl, % ( SelectedSlots[23, 1] := !SelectedSlots[23, 1] ) ? "Show" : "Hide", Selected23
Return

Slot24:
	GuiControl, % ( SelectedSlots[24, 1] := !SelectedSlots[24, 1] ) ? "Show" : "Hide", Selected24
Return

Slot25:
	GuiControl, % ( SelectedSlots[25, 1] := !SelectedSlots[25, 1] ) ? "Show" : "Hide", Selected25
Return

Slot26:
	GuiControl, % ( SelectedSlots[26, 1] := !SelectedSlots[26, 1] ) ? "Show" : "Hide", Selected26
Return

Slot27:
	GuiControl, % ( SelectedSlots[27, 1] := !SelectedSlots[27, 1] ) ? "Show" : "Hide", Selected27
Return

Slot28:
	GuiControl, % ( SelectedSlots[28, 1] := !SelectedSlots[28, 1] ) ? "Show" : "Hide", Selected28
Return

Slot29:
	GuiControl, % ( SelectedSlots[29, 1] := !SelectedSlots[29, 1] ) ? "Show" : "Hide", Selected29
Return

Slot30:
	GuiControl, % ( SelectedSlots[30, 1] := !SelectedSlots[30, 1] ) ? "Show" : "Hide", Selected30
Return

Slot31:
	GuiControl, % ( SelectedSlots[31, 1] := !SelectedSlots[31, 1] ) ? "Show" : "Hide", Selected31
Return

Slot32:
	GuiControl, % ( SelectedSlots[32, 1] := !SelectedSlots[32, 1] ) ? "Show" : "Hide", Selected32
Return

Slot33:
	GuiControl, % ( SelectedSlots[33, 1] := !SelectedSlots[33, 1] ) ? "Show" : "Hide", Selected33
Return

Slot34:
	GuiControl, % ( SelectedSlots[34, 1] := !SelectedSlots[34, 1] ) ? "Show" : "Hide", Selected34
Return

Slot35:
	GuiControl, % ( SelectedSlots[35, 1] := !SelectedSlots[35, 1] ) ? "Show" : "Hide", Selected35
Return

Slot36:	
	GuiControl, % ( SelectedSlots[36, 1] := !SelectedSlots[36, 1] ) ? "Show" : "Hide", Selected36
Return

Slot37:
	GuiControl, % ( SelectedSlots[37, 1] := !SelectedSlots[37, 1] ) ? "Show" : "Hide", Selected37
Return

Slot38:
	GuiControl, % ( SelectedSlots[38, 1] := !SelectedSlots[38, 1] ) ? "Show" : "Hide", Selected38
Return

Slot39:
	GuiControl, % ( SelectedSlots[39, 1] := !SelectedSlots[39, 1] ) ? "Show" : "Hide", Selected39
Return

Slot40:
	GuiControl, % ( SelectedSlots[40, 1] := !SelectedSlots[40, 1] ) ? "Show" : "Hide", Selected40
Return

Slot41:
	GuiControl, % ( SelectedSlots[41, 1] := !SelectedSlots[41, 1] ) ? "Show" : "Hide", Selected41
Return

Slot42:
	GuiControl, % ( SelectedSlots[42, 1] := !SelectedSlots[42, 1] ) ? "Show" : "Hide", Selected42
Return

Slot43:
	GuiControl, % ( SelectedSlots[43, 1] := !SelectedSlots[43, 1] ) ? "Show" : "Hide", Selected43
Return

Slot44:
	GuiControl, % ( SelectedSlots[44, 1] := !SelectedSlots[44, 1] ) ? "Show" : "Hide", Selected44
Return

Slot45:
	GuiControl, % ( SelectedSlots[45, 1] := !SelectedSlots[45, 1]) ? "Show" : "Hide", Selected45
Return

SetSlotsSave:
	NewSelectedSlots =
    TotalSlots := SelectedSlots.MaxIndex()

    for index, element in SelectedSlots
    {
        if (index = TotalSlots)
		{
			if (SelectedSlots[index, 1] = "")
			{
				State := 0
			} 
			else 
			{
				State := SelectedSlots[index, 1]
			}
			NewSelectedSlots .= State
        } 
		else 
		{	
			if (SelectedSlots[index, 1] = "")
			{
				State := 0
			} 
			else 
			{
				State := SelectedSlots[index, 1]
			}
			NewSelectedSlots .= State . "|"
		}
    }
	IniWrite, %NewSelectedSlots%, %A_ScriptDir%/data/configs/bdsystem.ini, InventorySlots, SelectedSlots
Return

SetDefaultSlots:
	DefaultSlots := StrSplit("0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|1|1|1|1|1|1|1|1|1|1|1|1|1|1|1|1|1|1|1|0|0|0|0|0|0|0|0|0|0", "|")
	Loop % SelectedSlots.MaxIndex()
	{
		SelectedSlots[a_index, 1] := DefaultSlots[a_index]
		if (SelectedSlots[a_index, 1] = 0)
		{
			Guicontrol, Hide, Selected%a_index%
		}
		else
		{
			Guicontrol, Show, Selected%a_index%
		}
	}
	Gosub, SetSlotsSave
Return

LoadGUIImgSetSlots()
{
	Global
		Loop, 45
		{
			ImgSlotX_1 := ImgSlotX_6 := ImgSlotX_11 := ImgSlotX_16 := ImgSlotX_21 := ImgSlotX_26 := ImgSlotX_31 := ImgSlotX_36 := ImgSlotX_41 := 41
			ImgSlotX_2 := ImgSlotX_7 := ImgSlotX_12 := ImgSlotX_17 := ImgSlotX_22 := ImgSlotX_27 := ImgSlotX_32 := ImgSlotX_37 := ImgSlotX_42 := ImgSlotX_1+37
			ImgSlotX_3 := ImgSlotX_8 := ImgSlotX_13 := ImgSlotX_18 := ImgSlotX_23 := ImgSlotX_28 := ImgSlotX_33 := ImgSlotX_38 := ImgSlotX_43 := ImgSlotX_2+38
			ImgSlotX_4 := ImgSlotX_9 := ImgSlotX_14 := ImgSlotX_19 := ImgSlotX_24 := ImgSlotX_29 := ImgSlotX_34 := ImgSlotX_39 := ImgSlotX_44 := ImgSlotX_3+38 
			ImgSlotX_5 := ImgSlotX_10 := ImgSlotX_15 := ImgSlotX_20 := ImgSlotX_25 := ImgSlotX_30 := ImgSlotX_35 := ImgSlotX_40 := ImgSlotX_45 := ImgSlotX_4+39
			
			ImgSlotY_Base := 191
			
			if (a_index <= 5)
			{
				ImgSlotX := ImgSlotX_%a_index%
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY_Base + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY_Base% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >5 and a_index <= 10)
			{
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 36
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >10 and a_index <= 15)
			{
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 73
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >15 and a_index <= 20)
			{	
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 110
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >20 and a_index <= 25)
			{	
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 146
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >25 and a_index <= 30)
			{	
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 183
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >30 and a_index <= 35)
			{	
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 219
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >35 and a_index <= 40)
			{	
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 255
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
			else if (a_index >40 and a_index <= 45)
			{	
				ImgSlotX := ImgSlotX_%a_index%
				ImgSlotY := ImgSlotY_Base + 292
				ImgSelectedX := ImgSlotX + 6
				ImgSelectedY := ImgSlotY + 4
				Gui, Main:Add, Picture, x%ImgSlotX% y%ImgSlotY% w31 h31 gSlot%a_index%, %A_ScriptDir%/data/img/inv/slots/%a_index%.png
				Gui, Main:Add, Picture, x%ImgSelectedX% y%ImgSelectedY% w21 h22 BackgroundTrans vSelected%a_index% gSlot%a_index%, %A_ScriptDir%/data/img/inv/cross.png
			}
		}
	Return
}

LoadSelectedSlot()
{
	IniRead, GetSelectedSlots, %A_ScriptDir%/data/configs/bdsystem.ini, InventorySlots, SelectedSlots
	LoadSelectedSlots := StrSplit(GetSelectedSlots, "|") 

	Loop, 45
	{
		IniRead, GetBaseX, %A_ScriptDir%/data/configs/bdsystem.ini, SlotsCoord, BaseX
		IniRead, GetBaseY, %A_ScriptDir%/data/configs/bdsystem.ini, SlotsCoord, BaseY
		
		BaseX_1 := BaseX_6 := BaseX_11 := BaseX_16 := BaseX_21 := BaseX_26 := BaseX_31 := BaseX_36 := BaseX_41 := GetBaseX
		BaseX_2 := BaseX_7 := BaseX_12 := BaseX_17 := BaseX_22 := BaseX_27 := BaseX_32 := BaseX_37 := BaseX_42 := BaseX_1+20 ;Relative 20, Client 20
		BaseX_3 := BaseX_8 := BaseX_13 := BaseX_18 := BaseX_23 := BaseX_28 := BaseX_33 := BaseX_38 := BaseX_43 := BaseX_2+21 ;Relative 21, Client 21
		BaseX_4 := BaseX_9 := BaseX_14 := BaseX_19 := BaseX_24 := BaseX_29 := BaseX_34 := BaseX_39 := BaseX_44 := BaseX_3+21 ;Relative 21, Client 21
		BaseX_5 := BaseX_10 := BaseX_15 := BaseX_20 := BaseX_25 := BaseX_30 := BaseX_35 := BaseX_40 := BaseX_45 := BaseX_4+21 ;Relative 21, Client 21
		
		if (a_index <= 5)
		{
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >5 and a_index <= 10)
		{
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+20
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >10 and a_index <= 15)
		{
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+40
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >15 and a_index <= 20)
		{	
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+60
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >20 and a_index <= 25)
		{	
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+80
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >25 and a_index <= 30)
		{	
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+100
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >30 and a_index <= 35)
		{	
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+120
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >35 and a_index <= 40)
		{	
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+140
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
		else if (a_index >40 and a_index <= 45)
		{	
			BaseX := BaseX_%a_index%
			BaseY := GetBaseY+160
			SelectedSlots.Insert(Array(LoadSelectedSlots[a_index], BaseX, BaseY))
		}
	}
	
	Loop % SelectedSlots.MaxIndex()
	{
		if (SelectedSlots[a_index, 1] = 0)
		{
			Guicontrol, Hide, Selected%a_index%
		}
		else
		{
			Guicontrol, Show, Selected%a_index%
		}
	}
	Return
}
; ~End~ Slots Config.
; -------------------------------------------------------------------------




; -------------------------------------------------------------------------
; ~Start~ Resize Game Window.
ResizeAll:
	WinGet, ClientList, List, ahk_exe trove.exe
	Loop, %ClientList%
	{	
		WinGet, PID, PID, ahk_id %A_Index%
		WinMove, ahk_pid %PID%, , , , %ClientWidth%, %ClientHeight%
	}
Return
; ~End~ Resize Game Window.
; -------------------------------------------------------------------------




; -------------------------------------------------------------------------
; ~Start~ Auto Shutdown.

SDStart:
	SDActive := 1
	GuiControlGet, SDHour
	GuiControlGet, SDMin
	GuiControlGet, SDSec
	GuiControlGet, ShutdownType
	log("Auto shutdown for: " . ShutdownType . " has started.", TimeStamp, LogPath)
	
	SDTime = %SDHour%%SDMin%%SDSec%
	IniWrite, %SDTime%, %A_ScriptDir%/data/configs/miscsettings.ini, AutoShutdown, Time
	IniWrite, %ShutdownType%, %A_ScriptDir%/data/configs/miscsettings.ini, AutoShutdown, Type
	
	SDTimeSec := (SDHour*3600) + (SDMin*60) + SDSec
	SetTimer, SDUpdateOSD, 200
	StartTime = %A_Now%
	EndTime = %A_Now%
	EnvAdd EndTime, SDTimeSec, seconds
	EnvSub StartTime, EndTime, seconds
	StartTime := Abs(StartTime)
	perc := 0 ; Resets percentage to 0, otherwise this loop never sees the counter reset
	Loop
	{
		if perc = 100
		{
			break ; Terminate the loop
		} 
		else
		{
			continue ; Skip the below and start a new iteration
		}
	}
	
	if (SDActive = 0)
	{
		Return
	}
	else
	{
		if (ShutdownType = "Trove")
		{
			log("Auto shutdown time's up going to shutdown all Trove window now.", TimeStamp, LogPath)
			WinClose, ahk_exe trove.exe
		}
		else
		{
			log("Auto shutdown time's up going to shutdown your computer now.", TimeStamp, LogPath)
			Shutdown, 5
		}
	}
	SDActive := 0
Return

SDUpdateOSD:
	if (SDActive = 0)
	{
		perc = 100
		SetTimer, SDUpdateOSD, Off
		GuiControl, Main:, SDCDTime, 00:00:00
	}
	else 
	{
		mysec := EndTime
		EnvSub, mysec, %A_Now%, seconds
		GuiControl, Main:, SDCDTime, % FormatSeconds(mysec)
		perc := ((StartTime-mysec)/StartTime)*100
		perc := Floor(perc)
		If (perc = 100)
		{
			SetTimer, SDUpdateOSD, Off
		}
	}
Return

SDStop:
	SDActive := 0
Return

; ~End~ Auto Shutdown.
; -------------------------------------------------------------------------